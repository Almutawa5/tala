<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gold Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        gold: {
                            50: '#fbf8eb',
                            100: '#f5eccd',
                            200: '#ebd89f',
                            300: '#dfbf6d',
                            400: '#d4a746',
                            500: '#c68e2d',
                            600: '#aa6f22',
                            700: '#88521e',
                            800: '#70411e',
                            900: '#5e361b',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Theme Variables */
        :root {
            --primary: #c68e2d;
            --primary-dark: #aa6f22;
            --primary-light: #d4a746;
            --bg-main: #f8fafc;
            --bg-card: rgba(255, 255, 255, 0.95);
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
        }

        /* Silver Theme */
        body.theme-silver {
            --primary: #71717a;
            --primary-dark: #52525b;
            --primary-light: #a1a1aa;
        }

        /* Dark Theme */
        body.theme-dark {
            --primary: #fbbf24;
            --primary-dark: #f59e0b;
            --primary-light: #fcd34d;
            --bg-main: #0f172a;
            --bg-card: rgba(30, 41, 59, 0.95);
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --border: #334155;
        }

        body.theme-dark {
            background-color: var(--bg-main);
            color: var(--text-primary);
        }

        /* Light Theme */
        body.theme-light {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --primary-light: #60a5fa;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        .glass-panel {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        .input-group:focus-within label {
            color: var(--primary);
        }

        .input-group:focus-within input[type="number"] {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(198, 142, 45, 0.1);
        }

        /* Range Slider */
        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            margin-top: -6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }

        input[type=range]:focus::-webkit-slider-runnable-track {
            background: #cbd5e1;
        }

        /* Help Guide */
        .help-step {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Theme Swatches */
        .theme-swatch {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .theme-swatch:hover {
            transform: scale(1.1);
        }

        .theme-swatch.active {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(198, 142, 45, 0.2);
        }
    </style>
</head>

<body
    class="bg-slate-50 text-slate-800 min-h-screen flex flex-col items-center justify-center p-4 font-sans selection:bg-gold-200 selection:text-gold-900">

    <div class="w-full max-w-md">
        <!-- Header -->
        <div class="text-center mb-6">
            <div class="inline-flex items-center justify-center p-3 bg-gold-100 rounded-full mb-4 shadow-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gold-600" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <h1 class="text-3xl font-bold text-slate-900 mb-2" data-i18n="appTitle">Gold Calculator</h1>

            <!-- Live Price Ticker -->
            <div id="livePriceContainer"
                class="inline-flex items-center gap-2 bg-slate-900 text-gold-400 px-4 py-2 rounded-full text-sm font-medium shadow-md cursor-pointer hover:bg-slate-800 transition-colors mb-2"
                title="Click to use this price">
                <span class="animate-pulse">‚óè</span>
                <span id="livePriceLabel">Live:</span>
                <span id="livePriceValue">Loading...</span>
            </div>

            <!-- Last Updated Timestamp -->
            <p class="text-slate-400 text-xs mt-1" id="lastUpdated" data-i18n="lastUpdated">Last updated: --</p>

            <p class="text-slate-500 text-xs mt-1" data-i18n="appSubtitle">Jewelry Price Breakdown</p>
        </div>

        <!-- Controls Row -->
        <div class="flex justify-between items-center mb-4 gap-2">
            <!-- Tabs -->
            <div class="flex bg-white p-1 rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                <button onclick="switchTab('breakdown')" id="tab-breakdown"
                    class="px-3 py-1.5 rounded-lg text-xs font-medium transition-all text-white bg-gold-500 shadow-sm"
                    data-i18n="tabBreakdown">Breakdown</button>
                <button onclick="switchTab('estimator')" id="tab-estimator"
                    class="px-3 py-1.5 rounded-lg text-xs font-medium transition-all text-slate-500 hover:text-slate-700"
                    data-i18n="tabEstimator">Estimator</button>
            </div>

            <div class="flex gap-2">
                <!-- Help Button -->
                <button id="helpBtn"
                    class="text-xs font-medium bg-white border border-slate-200 px-3 py-1.5 rounded-full hover:bg-slate-50 transition-colors flex items-center gap-2 shadow-sm text-slate-600">
                    <span>‚ùì</span>
                </button>

                <!-- Settings Button -->
                <button id="settingsBtn"
                    class="text-xs font-medium bg-white border border-slate-200 px-3 py-1.5 rounded-full hover:bg-slate-50 transition-colors flex items-center gap-2 shadow-sm text-slate-600">
                    <span>‚öôÔ∏è</span>
                </button>

                <!-- Language Toggle -->
                <button id="langToggle"
                    class="text-xs font-medium bg-white border border-slate-200 px-3 py-1.5 rounded-full hover:bg-slate-50 transition-colors flex items-center gap-2 shadow-sm text-slate-600">
                    <span class="text-lg">üåê</span>
                    <span id="langLabel">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</span>
                </button>
            </div>
        </div>

        <!-- Help Modal -->
        <div id="helpModal"
            class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
            <div
                class="bg-white rounded-2xl w-full max-w-md p-6 shadow-2xl transform transition-all scale-100 max-h-[80vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold text-slate-900" data-i18n="helpTitle">How to Use</h3>
                    <button id="closeHelp" class="text-slate-400 hover:text-slate-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <div id="helpContent" class="space-y-4 help-step">
                    <div class="p-4 bg-gold-50 rounded-xl">
                        <h4 class="font-bold text-gold-900 mb-2" data-i18n="helpStep1Title">1. Live Price</h4>
                        <p class="text-sm text-slate-700" data-i18n="helpStep1">Click the live price ticker at the top
                            to automatically fill the gold price in both calculators.</p>
                    </div>
                    <div class="p-4 bg-blue-50 rounded-xl">
                        <h4 class="font-bold text-blue-900 mb-2" data-i18n="helpStep2Title">2. Breakdown Mode</h4>
                        <p class="text-sm text-slate-700" data-i18n="helpStep2">Enter the item price, gold price, and
                            weight to see the cost breakdown including VAT, raw gold cost, and making charges.</p>
                    </div>
                    <div class="p-4 bg-emerald-50 rounded-xl">
                        <h4 class="font-bold text-emerald-900 mb-2" data-i18n="helpStep3Title">3. Estimator Mode</h4>
                        <p class="text-sm text-slate-700" data-i18n="helpStep3">Enter gold price, weight, and making
                            charge per gram to estimate the total price of an item.</p>
                    </div>
                    <div class="p-4 bg-purple-50 rounded-xl">
                        <h4 class="font-bold text-purple-900 mb-2" data-i18n="helpStep4Title">4. Settings</h4>
                        <p class="text-sm text-slate-700" data-i18n="helpStep4">Click the settings button to change
                            currency, karat, VAT percentage, and theme. Your preferences are saved automatically.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal"
            class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
            <div
                class="bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl transform transition-all scale-100 max-h-[80vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold text-slate-900" data-i18n="settingsTitle">Settings</h3>
                    <button id="closeSettings" class="text-slate-400 hover:text-slate-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <div class="space-y-4">
                    <!-- Theme Selection -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2"
                            data-i18n="themeLabel">Theme</label>
                        <div class="flex gap-3">
                            <div class="theme-swatch active" data-theme="gold"
                                style="background: linear-gradient(135deg, #c68e2d, #d4a746);" title="Gold"></div>
                            <div class="theme-swatch" data-theme="silver"
                                style="background: linear-gradient(135deg, #71717a, #a1a1aa);" title="Silver"></div>
                            <div class="theme-swatch" data-theme="dark"
                                style="background: linear-gradient(135deg, #0f172a, #1e293b);" title="Dark"></div>
                            <div class="theme-swatch" data-theme="light"
                                style="background: linear-gradient(135deg, #3b82f6, #60a5fa);" title="Light"></div>
                        </div>
                    </div>

                    <!-- Currency Selection -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2"
                            data-i18n="currencyLabel">Currency</label>
                        <select id="currencySelect"
                            class="w-full px-4 py-2 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 focus:outline-none focus:border-gold-500">
                            <option value="BHD">Bahraini Dinar (BHD)</option>
                            <option value="SAR">Saudi Riyal (SAR)</option>
                            <option value="QAR">Qatari Riyal (QAR)</option>
                            <option value="AED">UAE Dirham (AED)</option>
                            <option value="USD">US Dollar (USD)</option>
                        </select>
                    </div>

                    <!-- Karat Selection -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2" data-i18n="karatLabel">Gold
                            Karat</label>
                        <select id="karatSelect"
                            class="w-full px-4 py-2 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 focus:outline-none focus:border-gold-500">
                            <option value="24">24K</option>
                            <option value="22">22K</option>
                            <option value="21" selected>21K</option>
                            <option value="18">18K</option>
                        </select>
                    </div>

                    <!-- VAT Percentage -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2" data-i18n="vatLabel">VAT Percentage
                            (%)</label>
                        <input type="number" id="vatInput" min="0" max="100" step="0.1" value="10"
                            class="w-full px-4 py-2 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 focus:outline-none focus:border-gold-500">
                    </div>
                </div>

                <button id="saveSettings"
                    class="w-full mt-6 bg-gold-500 text-white py-3 rounded-xl font-bold shadow-lg shadow-gold-500/30 hover:bg-gold-600 transition-all"
                    data-i18n="saveBtn">
                    Save Changes
                </button>
            </div>
        </div>

        <!-- Main Card -->
        <div class="glass-panel rounded-2xl overflow-hidden min-h-[500px] flex flex-col">
            <!-- VIEW: BREAKDOWN -->
            <div id="view-breakdown" class="flex flex-col h-full">
                <!-- Inputs Section -->
                <div class="p-6 space-y-6 flex-grow">

                    <!-- Gold Price Input -->
                    <div class="input-group transition-all duration-200">
                        <label for="goldPrice"
                            class="block text-sm font-medium text-slate-600 mb-1.5 flex justify-between">
                            <span data-i18n="goldPrice">Gold Price per Gram</span>
                            <span class="text-xs text-slate-400 font-normal" data-i18n="dailyPrice">Daily Price</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="goldPrice" step="0.01" placeholder="0.00"
                                class="block w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 focus:outline-none focus:bg-white transition-all font-medium text-lg placeholder:text-slate-300 mb-2">
                            <input type="range" id="goldPriceRange" min="0" max="100" step="0.1"
                                class="w-full accent-gold-500">
                        </div>
                    </div>

                    <!-- Item Price Input -->
                    <div class="input-group transition-all duration-200">
                        <label for="itemPrice"
                            class="block text-sm font-medium text-slate-600 mb-1.5 flex justify-between">
                            <span id="itemPriceLabel" data-i18n="itemPrice">Item Price (with VAT)</span>
                            <span class="text-xs text-slate-400 font-normal" data-i18n="totalPrice">Total</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="itemPrice" step="0.01" placeholder="0.00"
                                class="block w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 focus:outline-none focus:bg-white transition-all font-medium text-lg placeholder:text-slate-300 mb-2">
                            <input type="range" id="itemPriceRange" min="0" max="1000" step="1"
                                class="w-full accent-gold-500">
                        </div>
                    </div>

                    <!-- Weight Input -->
                    <div class="input-group transition-all duration-200">
                        <label for="weight"
                            class="block text-sm font-medium text-slate-600 mb-1.5 flex justify-between">
                            <span data-i18n="weight">Weight (grams)</span>
                            <span class="text-xs text-slate-400 font-normal" data-i18n="netWeight">Net</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="weight" step="0.01" placeholder="0.00"
                                class="block w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 focus:outline-none focus:bg-white transition-all font-medium text-lg placeholder:text-slate-300 mb-2">
                            <input type="range" id="weightRange" min="0" max="50" step="0.1"
                                class="w-full accent-gold-500">
                        </div>
                    </div>

                </div>

                <!-- Results Section -->
                <div class="bg-slate-900 p-6 text-white border-t border-slate-800 mt-auto">
                    <h3 class="text-gold-400 text-xs font-bold uppercase tracking-wider mb-4 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-gold-500"></span>
                        <span data-i18n="breakdown">Cost Breakdown</span>
                    </h3>

                    <div class="space-y-4">
                        <!-- VAT -->
                        <div class="flex justify-between items-center py-2 border-b border-slate-800/50">
                            <span class="text-slate-400 text-sm" id="vatAmountLabel" data-i18n="vatAmount">VAT Amount
                                (10%)</span>
                            <span class="font-mono text-lg font-medium text-white" id="resVat">0.00</span>
                        </div>

                        <!-- Price w/o VAT -->
                        <div class="flex justify-between items-center py-2 border-b border-slate-800/50">
                            <span class="text-slate-400 text-sm" data-i18n="priceNoVat">Item Price w/o VAT</span>
                            <span class="font-mono text-lg font-medium text-white" id="resPriceNoVat">0.00</span>
                        </div>

                        <!-- Raw Gold Cost -->
                        <div class="flex justify-between items-center py-2 border-b border-slate-800/50">
                            <span class="text-slate-400 text-sm" data-i18n="rawGold">Raw Gold Cost</span>
                            <span class="font-mono text-lg font-medium text-gold-400" id="resRawGold">0.00</span>
                        </div>

                        <!-- Total Making -->
                        <div class="flex justify-between items-center py-2 border-b border-slate-800/50">
                            <span class="text-slate-400 text-sm" data-i18n="totalMaking">Total Making Charges</span>
                            <span class="font-mono text-lg font-medium text-emerald-400" id="resTotalMaking">0.00</span>
                        </div>

                        <!-- Making per Gram -->
                        <div class="flex justify-between items-center pt-2">
                            <span class="text-slate-400 text-sm" data-i18n="makingPerGram">Making Charge / Gram</span>
                            <span class="font-mono text-lg font-medium text-emerald-400"
                                id="resMakingPerGram">0.00</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: ESTIMATOR -->
            <div id="view-estimator" class="hidden flex-col h-full">
                <!-- Inputs Section -->
                <div class="p-6 space-y-6 flex-grow">

                    <!-- Gold Price Input (Estimator) -->
                    <div class="input-group transition-all duration-200">
                        <label for="estGoldPrice"
                            class="block text-sm font-medium text-slate-600 mb-1.5 flex justify-between">
                            <span data-i18n="goldPrice">Gold Price per Gram</span>
                            <span class="text-xs text-slate-400 font-normal" data-i18n="dailyPrice">Daily Price</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="estGoldPrice" step="0.01" placeholder="0.00"
                                class="block w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 focus:outline-none focus:bg-white transition-all font-medium text-lg placeholder:text-slate-300 mb-2">
                            <input type="range" id="estGoldPriceRange" min="0" max="100" step="0.1"
                                class="w-full accent-gold-500">
                        </div>
                    </div>

                    <!-- Weight Input (Estimator) -->
                    <div class="input-group transition-all duration-200">
                        <label for="estWeight"
                            class="block text-sm font-medium text-slate-600 mb-1.5 flex justify-between">
                            <span data-i18n="weight">Weight (grams)</span>
                            <span class="text-xs text-slate-400 font-normal" data-i18n="netWeight">Net</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="estWeight" step="0.01" placeholder="0.00"
                                class="block w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 focus:outline-none focus:bg-white transition-all font-medium text-lg placeholder:text-slate-300 mb-2">
                            <input type="range" id="estWeightRange" min="0" max="50" step="0.1"
                                class="w-full accent-gold-500">
                        </div>
                    </div>

                    <!-- Making Charge Input (Estimator) -->
                    <div class="input-group transition-all duration-200">
                        <label for="estMakingPerGram"
                            class="block text-sm font-medium text-slate-600 mb-1.5 flex justify-between">
                            <span data-i18n="makingPerGramInput">Making Charge / Gram</span>
                            <span class="text-xs text-slate-400 font-normal" data-i18n="laborCost">Labor Cost</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="estMakingPerGram" step="0.01" placeholder="0.00"
                                class="block w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 focus:outline-none focus:bg-white transition-all font-medium text-lg placeholder:text-slate-300 mb-2">
                            <input type="range" id="estMakingPerGramRange" min="0" max="50" step="0.1"
                                class="w-full accent-gold-500">
                        </div>
                    </div>

                </div>

                <!-- Results Section -->
                <div class="bg-slate-900 p-6 text-white border-t border-slate-800 mt-auto">
                    <h3 class="text-gold-400 text-xs font-bold uppercase tracking-wider mb-4 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-gold-500"></span>
                        <span data-i18n="estimatedPrice">Estimated Price</span>
                    </h3>

                    <div class="space-y-4">
                        <!-- Raw Gold Cost -->
                        <div class="flex justify-between items-center py-2 border-b border-slate-800/50">
                            <span class="text-slate-400 text-sm" data-i18n="rawGold">Raw Gold Cost</span>
                            <span class="font-mono text-lg font-medium text-gold-400" id="estResRawGold">0.00</span>
                        </div>

                        <!-- Total Making -->
                        <div class="flex justify-between items-center py-2 border-b border-slate-800/50">
                            <span class="text-slate-400 text-sm" data-i18n="totalMaking">Total Making Charges</span>
                            <span class="font-mono text-lg font-medium text-emerald-400"
                                id="estResTotalMaking">0.00</span>
                        </div>

                        <!-- VAT -->
                        <div class="flex justify-between items-center py-2 border-b border-slate-800/50">
                            <span class="text-slate-400 text-sm" id="estVatAmountLabel" data-i18n="vatAmount">VAT Amount
                                (10%)</span>
                            <span class="font-mono text-lg font-medium text-white" id="estResVat">0.00</span>
                        </div>

                        <!-- Total Price -->
                        <div class="flex justify-between items-center pt-2">
                            <span class="text-slate-400 text-sm" data-i18n="totalPriceLabel">Total Price (with
                                VAT)</span>
                            <span class="font-mono text-2xl font-bold text-white" id="estResTotalPrice">0.00</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="mt-6 text-center text-xs text-slate-400">
            <p>&copy; 2024 Gold Calculator. All rights reserved.</p>
        </div>
    </div>

    <script>
        // Translations
        const translations = {
            en: {
                appTitle: "Gold Calculator",
                appSubtitle: "Jewelry Price Breakdown",
                lastUpdated: "Last updated: --",
                tabBreakdown: "Breakdown",
                tabEstimator: "Estimator",
                goldPrice: "Gold Price per Gram",
                dailyPrice: "Daily Price",
                itemPrice: "Item Price (with VAT)",
                totalPrice: "Total",
                weight: "Weight (grams)",
                netWeight: "Net",
                breakdown: "Cost Breakdown",
                vatAmount: "VAT Amount",
                priceNoVat: "Item Price w/o VAT",
                rawGold: "Raw Gold Cost",
                totalMaking: "Total Making Charges",
                makingPerGram: "Making Charge / Gram",
                makingPerGramInput: "Making Charge / Gram",
                laborCost: "Labor Cost",
                estimatedPrice: "Estimated Price",
                totalPriceLabel: "Total Price (with VAT)",
                settingsTitle: "Settings",
                themeLabel: "Theme",
                currencyLabel: "Currency",
                karatLabel: "Gold Karat",
                vatLabel: "VAT Percentage (%)",
                saveBtn: "Save Changes",
                helpTitle: "How to Use",
                helpStep1Title: "1. Live Price",
                helpStep1: "Click the live price ticker at the top to automatically fill the gold price in both calculators.",
                helpStep2Title: "2. Breakdown Mode",
                helpStep2: "Enter the item price, gold price, and weight to see the cost breakdown including VAT, raw gold cost, and making charges.",
                helpStep3Title: "3. Estimator Mode",
                helpStep3: "Enter gold price, weight, and making charge per gram to estimate the total price of an item.",
                helpStep4Title: "4. Settings",
                helpStep4: "Click the settings button to change currency, karat, VAT percentage, and theme. Your preferences are saved automatically."
            },
            ar: {
                appTitle: "ÿ≠ÿßÿ≥ÿ®ÿ© ÿßŸÑÿ∞Ÿáÿ®",
                appSubtitle: "ÿ™ŸÅÿßÿµŸäŸÑ ÿ≥ÿπÿ± ÿßŸÑŸÖÿ¨ŸàŸáÿ±ÿßÿ™",
                lastUpdated: "ÿ¢ÿÆÿ± ÿ™ÿ≠ÿØŸäÿ´: --",
                tabBreakdown: "ÿ™ŸÅÿßÿµŸäŸÑ",
                tabEstimator: "ÿ™ŸÇÿØŸäÿ±",
                goldPrice: "ÿ≥ÿπÿ± ÿßŸÑÿ∞Ÿáÿ® ŸÑŸÑŸäŸàŸÖ",
                dailyPrice: "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑŸäŸàŸÖŸä",
                itemPrice: "ÿ≥ÿπÿ± ÿßŸÑŸÇÿ∑ÿπÿ© (ŸÖÿπ ÿßŸÑÿ∂ÿ±Ÿäÿ®ÿ©)",
                totalPrice: "ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä",
                weight: "ÿßŸÑŸàÿ≤ŸÜ (ÿ¨ÿ±ÿßŸÖ)",
                netWeight: "ÿßŸÑÿµÿßŸÅŸä",
                breakdown: "ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ™ŸÉŸÑŸÅÿ©",
                vatAmount: "ŸÇŸäŸÖÿ© ÿßŸÑÿ∂ÿ±Ÿäÿ®ÿ©",
                priceNoVat: "ÿ≥ÿπÿ± ÿßŸÑŸÇÿ∑ÿπÿ© ÿ®ÿØŸàŸÜ ÿ∂ÿ±Ÿäÿ®ÿ©",
                rawGold: "ÿ≥ÿπÿ± ÿßŸÑÿ∞Ÿáÿ® ÿßŸÑÿÆÿßŸÖ",
                totalMaking: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿµŸÜÿπŸäÿ©",
                makingPerGram: "ÿßŸÑŸÖÿµŸÜÿπŸäÿ© ŸÑŸÑÿ¨ÿ±ÿßŸÖ",
                makingPerGramInput: "ÿßŸÑŸÖÿµŸÜÿπŸäÿ© ŸÑŸÑÿ¨ÿ±ÿßŸÖ",
                laborCost: "ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿπŸÖŸÑ",
                estimatedPrice: "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ™ŸÇÿØŸäÿ±Ÿä",
                totalPriceLabel: "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä (ŸÖÿπ ÿßŸÑÿ∂ÿ±Ÿäÿ®ÿ©)",
                settingsTitle: "ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™",
                themeLabel: "ÿßŸÑŸÖÿ∏Ÿáÿ±",
                currencyLabel: "ÿßŸÑÿπŸÖŸÑÿ©",
                karatLabel: "ÿπŸäÿßÿ± ÿßŸÑÿ∞Ÿáÿ®",
                vatLabel: "ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ∂ÿ±Ÿäÿ®ÿ© (%)",
                saveBtn: "ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™",
                helpTitle: "ŸÉŸäŸÅŸäÿ© ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ",
                helpStep1Title: "Ÿ°. ÿßŸÑÿ≥ÿπÿ± ÿßŸÑŸÖÿ®ÿßÿ¥ÿ±",
                helpStep1: "ÿßŸÜŸÇÿ± ÿπŸÑŸâ ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ≥ÿπÿ± ÿßŸÑŸÖÿ®ÿßÿ¥ÿ± ŸÅŸä ÿßŸÑÿ£ÿπŸÑŸâ ŸÑŸÖŸÑÿ° ÿ≥ÿπÿ± ÿßŸÑÿ∞Ÿáÿ® ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÅŸä ŸÉŸÑÿß ÿßŸÑÿ≠ÿßÿ≥ÿ®ÿ™ŸäŸÜ.",
                helpStep2Title: "Ÿ¢. Ÿàÿ∂ÿπ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ",
                helpStep2: "ÿ£ÿØÿÆŸÑ ÿ≥ÿπÿ± ÿßŸÑŸÇÿ∑ÿπÿ© Ÿàÿ≥ÿπÿ± ÿßŸÑÿ∞Ÿáÿ® ŸàÿßŸÑŸàÿ≤ŸÜ ŸÑÿ±ÿ§Ÿäÿ© ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿ®ŸÖÿß ŸÅŸä ÿ∞ŸÑŸÉ ÿßŸÑÿ∂ÿ±Ÿäÿ®ÿ© Ÿàÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ∞Ÿáÿ® ÿßŸÑÿÆÿßŸÖ Ÿàÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ™ÿµŸÜŸäÿπ.",
                helpStep3Title: "Ÿ£. Ÿàÿ∂ÿπ ÿßŸÑÿ™ŸÇÿØŸäÿ±",
                helpStep3: "ÿ£ÿØÿÆŸÑ ÿ≥ÿπÿ± ÿßŸÑÿ∞Ÿáÿ® ŸàÿßŸÑŸàÿ≤ŸÜ Ÿàÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ™ÿµŸÜŸäÿπ ŸÑŸÉŸÑ ÿ¨ÿ±ÿßŸÖ ŸÑÿ™ŸÇÿØŸäÿ± ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä ŸÑŸÑŸÇÿ∑ÿπÿ©.",
                helpStep4Title: "Ÿ§. ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™",
                helpStep4: "ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÑÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿπŸÖŸÑÿ© ŸàÿßŸÑÿπŸäÿßÿ± ŸàŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ∂ÿ±Ÿäÿ®ÿ© ŸàÿßŸÑŸÖÿ∏Ÿáÿ±. Ÿäÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿ™ŸÅÿ∂ŸäŸÑÿßÿ™ŸÉ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã."
            }
        };

        let currentLang = 'en';
        let lastUpdateTime = null;

        // Settings State
        let settings = {
            currency: localStorage.getItem('goldCalc_currency') || 'BHD',
            karat: localStorage.getItem('goldCalc_karat') || '21',
            vatPercentage: parseFloat(localStorage.getItem('goldCalc_vat')) || 10,
            theme: localStorage.getItem('goldCalc_theme') || 'gold'
        };

        // Exchange Rates (Pegged to USD)
        const exchangeRates = {
            'USD': 1,
            'BHD': 0.376,
            'SAR': 3.75,
            'QAR': 3.64,
            'AED': 3.6725
        };

        // DOM Elements - Breakdown
        const inputs = {
            goldPrice: document.getElementById('goldPrice'),
            itemPrice: document.getElementById('itemPrice'),
            weight: document.getElementById('weight')
        };
        const ranges = {
            goldPrice: document.getElementById('goldPriceRange'),
            itemPrice: document.getElementById('itemPriceRange'),
            weight: document.getElementById('weightRange')
        };
        const results = {
            vat: document.getElementById('resVat'),
            priceNoVat: document.getElementById('resPriceNoVat'),
            rawGold: document.getElementById('resRawGold'),
            totalMaking: document.getElementById('resTotalMaking'),
            makingPerGram: document.getElementById('resMakingPerGram')
        };

        // DOM Elements - Estimator
        const estInputs = {
            goldPrice: document.getElementById('estGoldPrice'),
            weight: document.getElementById('estWeight'),
            makingPerGram: document.getElementById('estMakingPerGram')
        };
        const estRanges = {
            goldPrice: document.getElementById('estGoldPriceRange'),
            weight: document.getElementById('estWeightRange'),
            makingPerGram: document.getElementById('estMakingPerGramRange')
        };
        const estResults = {
            rawGold: document.getElementById('estResRawGold'),
            totalMaking: document.getElementById('estResTotalMaking'),
            vat: document.getElementById('estResVat'),
            totalPrice: document.getElementById('estResTotalPrice')
        };

        const langToggle = document.getElementById('langToggle');
        const langLabel = document.getElementById('langLabel');

        // Settings Elements
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsModal = document.getElementById('settingsModal');
        const closeSettings = document.getElementById('closeSettings');
        const saveSettings = document.getElementById('saveSettings');
        const currencySelect = document.getElementById('currencySelect');
        const karatSelect = document.getElementById('karatSelect');
        const vatInput = document.getElementById('vatInput');
        const livePriceValue = document.getElementById('livePriceValue');
        const livePriceContainer = document.getElementById('livePriceContainer');
        const lastUpdated = document.getElementById('lastUpdated');

        // Help Elements
        const helpBtn = document.getElementById('helpBtn');
        const helpModal = document.getElementById('helpModal');
        const closeHelp = document.getElementById('closeHelp');

        // Format Currency
        const formatCurrency = (num) => {
            return num.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        };

        // Format Timestamp
        const formatTimestamp = (date) => {
            if (!date) return '--';
            const now = new Date();
            const diff = Math.floor((now - date) / 1000); // seconds

            if (diff < 60) return currentLang === 'en' ? 'Just now' : 'ÿßŸÑÿ¢ŸÜ';
            if (diff < 3600) {
                const mins = Math.floor(diff / 60);
                return currentLang === 'en' ? `${mins} min${mins > 1 ? 's' : ''} ago` : `ŸÖŸÜÿ∞ ${mins} ÿØŸÇŸäŸÇÿ©`;
            }

            const hours = date.getHours();
            const minutes = date.getMinutes();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours % 12 || 12;
            return `${displayHours}:${minutes.toString().padStart(2, '0')} ${ampm}`;
        };

        // Update VAT Labels
        const updateVATLabels = () => {
            const vatText = currentLang === 'en'
                ? `VAT Amount (${settings.vatPercentage}%)`
                : `ŸÇŸäŸÖÿ© ÿßŸÑÿ∂ÿ±Ÿäÿ®ÿ© (${settings.vatPercentage}%)`;
            document.getElementById('vatAmountLabel').textContent = vatText;
            document.getElementById('estVatAmountLabel').textContent = vatText;

            const itemPriceText = currentLang === 'en'
                ? `Item Price (with ${settings.vatPercentage}% VAT)`
                : `ÿ≥ÿπÿ± ÿßŸÑŸÇÿ∑ÿπÿ© (ŸÖÿπ ${settings.vatPercentage}% ÿ∂ÿ±Ÿäÿ®ÿ©)`;
            document.getElementById('itemPriceLabel').textContent = itemPriceText;
        };

        // Calculate Breakdown
        const calculateBreakdown = () => {
            const goldPrice = parseFloat(inputs.goldPrice.value) || 0;
            const itemPrice = parseFloat(inputs.itemPrice.value) || 0;
            const weight = parseFloat(inputs.weight.value) || 0;

            if (goldPrice > 0 && itemPrice > 0 && weight > 0) {
                const vatAmount = itemPrice * (settings.vatPercentage / 100);
                const priceNoVat = itemPrice - vatAmount;
                const rawGoldCost = weight * goldPrice;
                const totalMaking = priceNoVat - rawGoldCost;
                const makingPerGram = totalMaking / weight;

                results.vat.textContent = formatCurrency(vatAmount);
                results.priceNoVat.textContent = formatCurrency(priceNoVat);
                results.rawGold.textContent = formatCurrency(rawGoldCost);
                results.totalMaking.textContent = formatCurrency(totalMaking);
                results.makingPerGram.textContent = formatCurrency(makingPerGram);
            } else {
                Object.values(results).forEach(el => el.textContent = '0.00');
            }
        };

        // Calculate Estimator
        const calculateEstimator = () => {
            const goldPrice = parseFloat(estInputs.goldPrice.value) || 0;
            const weight = parseFloat(estInputs.weight.value) || 0;
            const makingPerGram = parseFloat(estInputs.makingPerGram.value) || 0;

            if (goldPrice > 0 && weight > 0) {
                const rawGoldCost = weight * goldPrice;
                const totalMaking = weight * makingPerGram;
                const priceNoVat = rawGoldCost + totalMaking;
                const vatAmount = priceNoVat * (settings.vatPercentage / 100);
                const totalPrice = priceNoVat + vatAmount;

                estResults.rawGold.textContent = formatCurrency(rawGoldCost);
                estResults.totalMaking.textContent = formatCurrency(totalMaking);
                estResults.vat.textContent = formatCurrency(vatAmount);
                estResults.totalPrice.textContent = formatCurrency(totalPrice);
            } else {
                Object.values(estResults).forEach(el => el.textContent = '0.00');
            }
        };

        // Sync Inputs and Ranges
        const syncInputs = (source, target, callback) => {
            target.value = source.value;
            callback();
        };

        // Event Listeners - Breakdown
        Object.keys(inputs).forEach(key => {
            const input = inputs[key];
            const range = ranges[key];
            input.addEventListener('input', () => syncInputs(input, range, calculateBreakdown));
            range.addEventListener('input', () => syncInputs(range, input, calculateBreakdown));
        });

        // Event Listeners - Estimator
        Object.keys(estInputs).forEach(key => {
            const input = estInputs[key];
            const range = estRanges[key];
            input.addEventListener('input', () => syncInputs(input, range, calculateEstimator));
            range.addEventListener('input', () => syncInputs(range, input, calculateEstimator));
        });

        // Tab Switching
        const switchTab = (tabName) => {
            const breakdownView = document.getElementById('view-breakdown');
            const estimatorView = document.getElementById('view-estimator');
            const tabBreakdown = document.getElementById('tab-breakdown');
            const tabEstimator = document.getElementById('tab-estimator');

            if (tabName === 'breakdown') {
                breakdownView.classList.remove('hidden');
                breakdownView.classList.add('flex');
                estimatorView.classList.add('hidden');
                estimatorView.classList.remove('flex');

                tabBreakdown.classList.add('bg-gold-500', 'text-white', 'shadow-sm');
                tabBreakdown.classList.remove('text-slate-500', 'hover:text-slate-700');

                tabEstimator.classList.remove('bg-gold-500', 'text-white', 'shadow-sm');
                tabEstimator.classList.add('text-slate-500', 'hover:text-slate-700');

                calculateBreakdown();
            } else {
                breakdownView.classList.add('hidden');
                breakdownView.classList.remove('flex');
                estimatorView.classList.remove('hidden');
                estimatorView.classList.add('flex');

                tabEstimator.classList.add('bg-gold-500', 'text-white', 'shadow-sm');
                tabEstimator.classList.remove('text-slate-500', 'hover:text-slate-700');

                tabBreakdown.classList.remove('bg-gold-500', 'text-white', 'shadow-sm');
                tabBreakdown.classList.add('text-slate-500', 'hover:text-slate-700');

                calculateEstimator();
            }
        };

        // Language Switcher
        langToggle.addEventListener('click', () => {
            currentLang = currentLang === 'en' ? 'ar' : 'en';

            langLabel.textContent = currentLang === 'en' ? 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©' : 'English';
            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            document.documentElement.lang = currentLang;

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[currentLang][key]) {
                    el.textContent = translations[currentLang][key];
                }
            });

            updateVATLabels();
            if (lastUpdateTime) {
                lastUpdated.textContent = (currentLang === 'en' ? 'Last updated: ' : 'ÿ¢ÿÆÿ± ÿ™ÿ≠ÿØŸäÿ´: ') + formatTimestamp(lastUpdateTime);
            }
        });

        // Theme Switcher
        const applyTheme = (theme) => {
            document.body.className = document.body.className.replace(/theme-\w+/g, '');
            if (theme !== 'gold') {
                document.body.classList.add(`theme-${theme}`);
            }
            document.body.classList.add('bg-slate-50', 'text-slate-800', 'min-h-screen', 'flex', 'flex-col', 'items-center', 'justify-center', 'p-4', 'font-sans', 'selection:bg-gold-200', 'selection:text-gold-900');

            document.querySelectorAll('.theme-swatch').forEach(swatch => {
                swatch.classList.remove('active');
                if (swatch.dataset.theme === theme) {
                    swatch.classList.add('active');
                }
            });
        };

        document.querySelectorAll('.theme-swatch').forEach(swatch => {
            swatch.addEventListener('click', () => {
                const theme = swatch.dataset.theme;
                settings.theme = theme;
                localStorage.setItem('goldCalc_theme', theme);
                applyTheme(theme);
            });
        });

        // Help Modal
        helpBtn.addEventListener('click', () => helpModal.classList.remove('hidden'));
        closeHelp.addEventListener('click', () => helpModal.classList.add('hidden'));
        helpModal.addEventListener('click', (e) => {
            if (e.target === helpModal) helpModal.classList.add('hidden');
        });

        // Settings Modal
        const toggleModal = (show) => {
            if (show) {
                settingsModal.classList.remove('hidden');
                currencySelect.value = settings.currency;
                karatSelect.value = settings.karat;
                vatInput.value = settings.vatPercentage;
            } else {
                settingsModal.classList.add('hidden');
            }
        };

        settingsBtn.addEventListener('click', () => toggleModal(true));
        closeSettings.addEventListener('click', () => toggleModal(false));
        settingsModal.addEventListener('click', (e) => {
            if (e.target === settingsModal) toggleModal(false);
        });

        // Save Settings
        saveSettings.addEventListener('click', () => {
            settings.currency = currencySelect.value;
            settings.karat = karatSelect.value;
            settings.vatPercentage = parseFloat(vatInput.value) || 10;

            localStorage.setItem('goldCalc_currency', settings.currency);
            localStorage.setItem('goldCalc_karat', settings.karat);
            localStorage.setItem('goldCalc_vat', settings.vatPercentage);

            updateVATLabels();
            calculateBreakdown();
            calculateEstimator();

            toggleModal(false);
            fetchGoldPrice();
        });

        // Fetch Gold Price
        const fetchGoldPrice = async () => {
            livePriceValue.textContent = "Loading...";
            try {
                let priceUSD_oz = 2650.00;

                try {
                    const response = await fetch('https://api.gold-api.com/price/XAU');
                    if (response.ok) {
                        const data = await response.json();
                        priceUSD_oz = data.price;
                    }
                } catch (e) {
                    console.warn("API fetch failed, using fallback price");
                }

                const priceUSD_gram_24k = priceUSD_oz / 31.1035;
                const rate = exchangeRates[settings.currency] || 1;
                const priceLocal_gram_24k = priceUSD_gram_24k * rate;
                const karatFactor = parseInt(settings.karat) / 24;
                const finalPrice = priceLocal_gram_24k * karatFactor;

                livePriceValue.textContent = `${formatCurrency(finalPrice)} ${settings.currency} (${settings.karat}K)`;
                livePriceContainer.dataset.price = finalPrice.toFixed(2);

                lastUpdateTime = new Date();
                lastUpdated.textContent = (currentLang === 'en' ? 'Last updated: ' : 'ÿ¢ÿÆÿ± ÿ™ÿ≠ÿØŸäÿ´: ') + formatTimestamp(lastUpdateTime);

            } catch (error) {
                livePriceValue.textContent = "Error";
                console.error(error);
            }
        };

        // Click to Fill
        livePriceContainer.addEventListener('click', () => {
            const price = livePriceContainer.dataset.price;
            if (price) {
                inputs.goldPrice.value = price;
                ranges.goldPrice.value = price;
                calculateBreakdown();

                estInputs.goldPrice.value = price;
                estRanges.goldPrice.value = price;
                calculateEstimator();

                livePriceContainer.classList.add('ring-2', 'ring-gold-400');
                setTimeout(() => livePriceContainer.classList.remove('ring-2', 'ring-gold-400'), 200);
            }
        });

        // Initial Setup
        document.addEventListener('DOMContentLoaded', () => {
            Object.keys(inputs).forEach(key => ranges[key].value = inputs[key].value || 0);
            Object.keys(estInputs).forEach(key => estRanges[key].value = estInputs[key].value || 0);

            applyTheme(settings.theme);
            updateVATLabels();
            calculateBreakdown();
            calculateEstimator();
            switchTab('breakdown');

            fetchGoldPrice();
            setInterval(fetchGoldPrice, 60000);

            // Update timestamp every minute
            setInterval(() => {
                if (lastUpdateTime) {
                    lastUpdated.textContent = (currentLang === 'en' ? 'Last updated: ' : 'ÿ¢ÿÆÿ± ÿ™ÿ≠ÿØŸäÿ´: ') + formatTimestamp(lastUpdateTime);
                }
            }, 60000);
        });
    </script>
</body>

</html>