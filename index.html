<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gold Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        gold: {
                            50: '#fbf8eb',
                            100: '#f5eccd',
                            200: '#ebd89f',
                            300: '#dfbf6d',
                            400: '#d4a746',
                            500: '#c68e2d',
                            600: '#aa6f22',
                            700: '#88521e',
                            800: '#70411e',
                            900: '#5e361b',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom scrollbar for webkit */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #d4a746;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #aa6f22;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        .input-group:focus-within label {
            color: #c68e2d;
        }

        .input-group:focus-within input[type="number"] {
            border-color: #c68e2d;
            box-shadow: 0 0 0 3px rgba(198, 142, 45, 0.1);
        }

        /* Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #c68e2d;
            cursor: pointer;
            margin-top: -6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }

        input[type=range]:focus::-webkit-slider-runnable-track {
            background: #cbd5e1;
        }
    </style>
</head>

<body
    class="bg-slate-50 text-slate-800 min-h-screen flex flex-col items-center justify-center p-4 font-sans selection:bg-gold-200 selection:text-gold-900">

    <div class="w-full max-w-md">
        <!-- Header -->
        <div class="text-center mb-6">
            <div class="inline-flex items-center justify-center p-3 bg-gold-100 rounded-full mb-4 shadow-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gold-600" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <h1 class="text-3xl font-bold text-slate-900 mb-2" data-i18n="appTitle">Gold Calculator</h1>

            <!-- Live Price Ticker -->
            <div id="livePriceContainer"
                class="inline-flex items-center gap-2 bg-slate-900 text-gold-400 px-4 py-2 rounded-full text-sm font-medium shadow-md cursor-pointer hover:bg-slate-800 transition-colors mb-2"
                title="Click to use this price">
                <span class="animate-pulse">‚óè</span>
                <span id="livePriceLabel">Live:</span>
                <span id="livePriceValue">Loading...</span>
            </div>

            <p class="text-slate-500 text-xs mt-1" data-i18n="appSubtitle">Jewelry Price Breakdown</p>
        </div>

        <!-- Controls Row -->
        <div class="flex justify-between items-center mb-4 gap-2">
            <!-- Tabs -->
            <div class="flex bg-white p-1 rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                <button onclick="switchTab('breakdown')" id="tab-breakdown"
                    class="px-3 py-1.5 rounded-lg text-xs font-medium transition-all text-white bg-gold-500 shadow-sm"
                    data-i18n="tabBreakdown">Breakdown</button>
                <button onclick="switchTab('estimator')" id="tab-estimator"
                    class="px-3 py-1.5 rounded-lg text-xs font-medium transition-all text-slate-500 hover:text-slate-700"
                    data-i18n="tabEstimator">Estimator</button>
            </div>

            <div class="flex gap-2">
                <!-- Settings Button -->
                <button id="settingsBtn"
                    class="text-xs font-medium bg-white border border-slate-200 px-3 py-1.5 rounded-full hover:bg-slate-50 transition-colors flex items-center gap-2 shadow-sm text-slate-600">
                    <span>‚öôÔ∏è</span>
                </button>

                <!-- Language Toggle -->
                <button id="langToggle"
                    class="text-xs font-medium bg-white border border-slate-200 px-3 py-1.5 rounded-full hover:bg-slate-50 transition-colors flex items-center gap-2 shadow-sm text-slate-600">
                    <span class="text-lg">üåê</span>
                    <span id="langLabel">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</span>
                </button>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal"
            class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl transform transition-all scale-100">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold text-slate-900" data-i18n="settingsTitle">Settings</h3>
                    <button id="closeSettings" class="text-slate-400 hover:text-slate-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <div class="space-y-4">
                    <!-- Currency Selection -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2"
                            data-i18n="currencyLabel">Currency</label>
                        <select id="currencySelect"
                            class="w-full px-4 py-2 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 focus:outline-none focus:border-gold-500">
                            <option value="BHD">Bahraini Dinar (BHD)</option>
                            <option value="SAR">Saudi Riyal (SAR)</option>
                            <option value="QAR">Qatari Riyal (QAR)</option>
                            <option value="AED">UAE Dirham (AED)</option>
                            <option value="USD">US Dollar (USD)</option>
                        </select>
                    </div>

                    <!-- Karat Selection -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2" data-i18n="karatLabel">Gold
                            Karat</label>
                        <select id="karatSelect"
                            class="w-full px-4 py-2 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 focus:outline-none focus:border-gold-500">
                            <option value="24">24K</option>
                            <option value="22">22K</option>
                            <option value="21" selected>21K</option>
                            <option value="18">18K</option>
                        </select>
                    </div>
                </div>

                <button id="saveSettings"
                    class="w-full mt-6 bg-gold-500 text-white py-3 rounded-xl font-bold shadow-lg shadow-gold-500/30 hover:bg-gold-600 transition-all"
                    data-i18n="saveBtn">
                    Save Changes
                </button>
            </div>
        </div>

        <!-- Main Card -->
        <div class="glass-panel rounded-2xl overflow-hidden min-h-[500px] flex flex-col">
            <!-- VIEW: BREAKDOWN -->
            <div id="view-breakdown" class="flex flex-col h-full">
                <!-- Inputs Section -->
                <div class="p-6 space-y-6 flex-grow">

                    <!-- Gold Price Input -->
                    <div class="input-group transition-all duration-200">
                        <label for="goldPrice"
                            class="block text-sm font-medium text-slate-600 mb-1.5 flex justify-between">
                            <span data-i18n="goldPrice">Gold Price per Gram</span>
                            <span class="text-xs text-slate-400 font-normal" data-i18n="dailyPrice">Daily Price</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="goldPrice" step="0.01" placeholder="0.00"
                                class="block w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 focus:outline-none focus:bg-white transition-all font-medium text-lg placeholder:text-slate-300 mb-2">
                            <input type="range" id="goldPriceRange" min="0" max="100" step="0.1"
                                class="w-full accent-gold-500">
                        </div>
                    </div>

                    <!-- Item Price Input -->
                    <div class="input-group transition-all duration-200">
                        <label for="itemPrice"
                            class="block text-sm font-medium text-slate-600 mb-1.5 flex justify-between">
                            <span data-i18n="itemPrice">Item Price (with VAT)</span>
                            <span class="text-xs text-slate-400 font-normal" data-i18n="totalPrice">Total</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="itemPrice" step="0.01" placeholder="0.00"
                                class="block w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 focus:outline-none focus:bg-white transition-all font-medium text-lg placeholder:text-slate-300 mb-2">
                            <input type="range" id="itemPriceRange" min="0" max="1000" step="1"
                                class="w-full accent-gold-500">
                        </div>
                    </div>

                    <!-- Weight Input -->
                    <div class="input-group transition-all duration-200">
                        <label for="weight"
                            class="block text-sm font-medium text-slate-600 mb-1.5 flex justify-between">
                            <span data-i18n="weight">Weight (grams)</span>
                            <span class="text-xs text-slate-400 font-normal" data-i18n="netWeight">Net</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="weight" step="0.01" placeholder="0.00"
                                class="block w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 focus:outline-none focus:bg-white transition-all font-medium text-lg placeholder:text-slate-300 mb-2">
                            <input type="range" id="weightRange" min="0" max="50" step="0.1"
                                class="w-full accent-gold-500">
                        </div>
                    </div>

                </div>

                <!-- Results Section -->
                <div class="bg-slate-900 p-6 text-white border-t border-slate-800 mt-auto">
                    <h3 class="text-gold-400 text-xs font-bold uppercase tracking-wider mb-4 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-gold-500"></span>
                        <span data-i18n="breakdown">Cost Breakdown</span>
                    </h3>

                    <div class="space-y-4">
                        <!-- VAT -->
                        <div class="flex justify-between items-center py-2 border-b border-slate-800/50">
                            <span class="text-slate-400 text-sm" data-i18n="vatAmount">VAT Amount (9%)</span>
                            <span class="font-mono text-lg font-medium text-white" id="resVat">0.00</span>
                        </div>

                        <!-- Price w/o VAT -->
                        <div class="flex justify-between items-center py-2 border-b border-slate-800/50">
                            <span class="text-slate-400 text-sm" data-i18n="priceNoVat">Item Price w/o VAT</span>
                            <span class="font-mono text-lg font-medium text-white" id="resPriceNoVat">0.00</span>
                        </div>

                        <!-- Raw Gold Cost -->
                        <div class="flex justify-between items-center py-2 border-b border-slate-800/50">
                            <span class="text-slate-400 text-sm" data-i18n="rawGold">Raw Gold Cost</span>
                            <span class="font-mono text-lg font-medium text-gold-400" id="resRawGold">0.00</span>
                        </div>

                        <!-- Total Making -->
                        <div class="flex justify-between items-center py-2 border-b border-slate-800/50">
                            <span class="text-slate-400 text-sm" data-i18n="totalMaking">Total Making Charges</span>
                            <span class="font-mono text-lg font-medium text-emerald-400" id="resTotalMaking">0.00</span>
                        </div>

                        <!-- Making per Gram -->
                        <div class="flex justify-between items-center pt-2">
                            <span class="text-slate-400 text-sm" data-i18n="makingPerGram">Making Charge / Gram</span>
                            <span class="font-mono text-lg font-medium text-emerald-400"
                                id="resMakingPerGram">0.00</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: ESTIMATOR -->
            <div id="view-estimator" class="hidden flex-col h-full">
                <!-- Inputs Section -->
                <div class="p-6 space-y-6 flex-grow">

                    <!-- Gold Price Input (Estimator) -->
                    <div class="input-group transition-all duration-200">
                        <label for="estGoldPrice"
                            class="block text-sm font-medium text-slate-600 mb-1.5 flex justify-between">
                            <span data-i18n="goldPrice">Gold Price per Gram</span>
                            <span class="text-xs text-slate-400 font-normal" data-i18n="dailyPrice">Daily Price</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="estGoldPrice" step="0.01" placeholder="0.00"
                                class="block w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 focus:outline-none focus:bg-white transition-all font-medium text-lg placeholder:text-slate-300 mb-2">
                            <input type="range" id="estGoldPriceRange" min="0" max="100" step="0.1"
                                class="w-full accent-gold-500">
                        </div>
                    </div>

                    <!-- Weight Input (Estimator) -->
                    <div class="input-group transition-all duration-200">
                        <label for="estWeight"
                            class="block text-sm font-medium text-slate-600 mb-1.5 flex justify-between">
                            <span data-i18n="weight">Weight (grams)</span>
                            <span class="text-xs text-slate-400 font-normal" data-i18n="netWeight">Net</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="estWeight" step="0.01" placeholder="0.00"
                                class="block w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 focus:outline-none focus:bg-white transition-all font-medium text-lg placeholder:text-slate-300 mb-2">
                            <input type="range" id="estWeightRange" min="0" max="50" step="0.1"
                                class="w-full accent-gold-500">
                        </div>
                    </div>

                    <!-- Making Charge Input (Estimator) -->
                    <div class="input-group transition-all duration-200">
                        <label for="estMakingPerGram"
                            class="block text-sm font-medium text-slate-600 mb-1.5 flex justify-between">
                            <span data-i18n="makingPerGramInput">Making Charge / Gram</span>
                            <span class="text-xs text-slate-400 font-normal" data-i18n="laborCost">Labor Cost</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="estMakingPerGram" step="0.01" placeholder="0.00"
                                class="block w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 focus:outline-none focus:bg-white transition-all font-medium text-lg placeholder:text-slate-300 mb-2">
                            <input type="range" id="estMakingPerGramRange" min="0" max="50" step="0.1"
                                class="w-full accent-gold-500">
                        </div>
                    </div>

                </div>

                <!-- Results Section -->
                <div class="bg-slate-900 p-6 text-white border-t border-slate-800 mt-auto">
                    <h3 class="text-gold-400 text-xs font-bold uppercase tracking-wider mb-4 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-gold-500"></span>
                        <span data-i18n="estimatedPrice">Estimated Price</span>
                    </h3>

                    <div class="space-y-4">
                        <!-- Raw Gold Cost -->
                        <div class="flex justify-between items-center py-2 border-b border-slate-800/50">
                            <span class="text-slate-400 text-sm" data-i18n="rawGold">Raw Gold Cost</span>
                            <span class="font-mono text-lg font-medium text-gold-400" id="estResRawGold">0.00</span>
                        </div>

                        <!-- Total Making -->
                        <div class="flex justify-between items-center py-2 border-b border-slate-800/50">
                            <span class="text-slate-400 text-sm" data-i18n="totalMaking">Total Making Charges</span>
                            <span class="font-mono text-lg font-medium text-emerald-400"
                                id="estResTotalMaking">0.00</span>
                        </div>

                        <!-- VAT -->
                        <div class="flex justify-between items-center py-2 border-b border-slate-800/50">
                            <span class="text-slate-400 text-sm" data-i18n="vatAmount">VAT Amount (9%)</span>
                            <span class="font-mono text-lg font-medium text-white" id="estResVat">0.00</span>
                        </div>

                        <!-- Total Price -->
                        <div class="flex justify-between items-center pt-2">
                            <span class="text-slate-400 text-sm" data-i18n="totalPriceLabel">Total Price (with
                                VAT)</span>
                            <span class="font-mono text-2xl font-bold text-white" id="estResTotalPrice">0.00</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="mt-6 text-center text-xs text-slate-400">
            <p>&copy; 2024 Gold Calculator. All rights reserved.</p>
        </div>
    </div>

    <script>
        // Translations
        const translations = {
            en: {
                appTitle: "Gold Calculator",
                appSubtitle: "Jewelry Price Breakdown",
                tabBreakdown: "Breakdown",
                tabEstimator: "Estimator",
                goldPrice: "Gold Price per Gram",
                dailyPrice: "Daily Price",
                itemPrice: "Item Price (with VAT)",
                totalPrice: "Total",
                weight: "Weight (grams)",
                netWeight: "Net",
                breakdown: "Cost Breakdown",
                vatAmount: "VAT Amount (9%)",
                priceNoVat: "Item Price w/o VAT",
                rawGold: "Raw Gold Cost",
                totalMaking: "Total Making Charges",
                makingPerGram: "Making Charge / Gram",
                makingPerGramInput: "Making Charge / Gram",
                laborCost: "Labor Cost",
                estimatedPrice: "Estimated Price",
                totalPriceLabel: "Total Price (with VAT)",
                settingsTitle: "Settings",
                currencyLabel: "Currency",
                karatLabel: "Gold Karat",
                saveBtn: "Save Changes"
            },
            ar: {
                appTitle: "ÿ≠ÿßÿ≥ÿ®ÿ© ÿßŸÑÿ∞Ÿáÿ®",
                appSubtitle: "ÿ™ŸÅÿßÿµŸäŸÑ ÿ≥ÿπÿ± ÿßŸÑŸÖÿ¨ŸàŸáÿ±ÿßÿ™",
                tabBreakdown: "ÿ™ŸÅÿßÿµŸäŸÑ",
                tabEstimator: "ÿ™ŸÇÿØŸäÿ±",
                goldPrice: "ÿ≥ÿπÿ± ÿßŸÑÿ∞Ÿáÿ® ŸÑŸÑŸäŸàŸÖ",
                dailyPrice: "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑŸäŸàŸÖŸä",
                itemPrice: "ÿ≥ÿπÿ± ÿßŸÑŸÇÿ∑ÿπÿ© (ŸÖÿπ ÿßŸÑÿ∂ÿ±Ÿäÿ®ÿ©)",
                totalPrice: "ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä",
                weight: "ÿßŸÑŸàÿ≤ŸÜ (ÿ¨ÿ±ÿßŸÖ)",
                netWeight: "ÿßŸÑÿµÿßŸÅŸä",
                breakdown: "ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ™ŸÉŸÑŸÅÿ©",
                vatAmount: "ŸÇŸäŸÖÿ© ÿßŸÑÿ∂ÿ±Ÿäÿ®ÿ© (9%)",
                priceNoVat: "ÿ≥ÿπÿ± ÿßŸÑŸÇÿ∑ÿπÿ© ÿ®ÿØŸàŸÜ ÿ∂ÿ±Ÿäÿ®ÿ©",
                rawGold: "ÿ≥ÿπÿ± ÿßŸÑÿ∞Ÿáÿ® ÿßŸÑÿÆÿßŸÖ",
                totalMaking: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿµŸÜÿπŸäÿ©",
                makingPerGram: "ÿßŸÑŸÖÿµŸÜÿπŸäÿ© ŸÑŸÑÿ¨ÿ±ÿßŸÖ",
                makingPerGramInput: "ÿßŸÑŸÖÿµŸÜÿπŸäÿ© ŸÑŸÑÿ¨ÿ±ÿßŸÖ",
                laborCost: "ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿπŸÖŸÑ",
                estimatedPrice: "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ™ŸÇÿØŸäÿ±Ÿä",
                totalPriceLabel: "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä (ŸÖÿπ ÿßŸÑÿ∂ÿ±Ÿäÿ®ÿ©)",
                settingsTitle: "ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™",
                currencyLabel: "ÿßŸÑÿπŸÖŸÑÿ©",
                karatLabel: "ÿπŸäÿßÿ± ÿßŸÑÿ∞Ÿáÿ®",
                saveBtn: "ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™"
            }
        };

        let currentLang = 'en';

        // Settings State
        let settings = {
            currency: localStorage.getItem('goldCalc_currency') || 'BHD',
            karat: localStorage.getItem('goldCalc_karat') || '21'
        };

        // Exchange Rates (Pegged to USD)
        const exchangeRates = {
            'USD': 1,
            'BHD': 0.376,
            'SAR': 3.75,
            'QAR': 3.64,
            'AED': 3.6725
        };

        // DOM Elements - Breakdown
        const inputs = {
            goldPrice: document.getElementById('goldPrice'),
            itemPrice: document.getElementById('itemPrice'),
            weight: document.getElementById('weight')
        };
        const ranges = {
            goldPrice: document.getElementById('goldPriceRange'),
            itemPrice: document.getElementById('itemPriceRange'),
            weight: document.getElementById('weightRange')
        };
        const results = {
            vat: document.getElementById('resVat'),
            priceNoVat: document.getElementById('resPriceNoVat'),
            rawGold: document.getElementById('resRawGold'),
            totalMaking: document.getElementById('resTotalMaking'),
            makingPerGram: document.getElementById('resMakingPerGram')
        };

        // DOM Elements - Estimator
        const estInputs = {
            goldPrice: document.getElementById('estGoldPrice'),
            weight: document.getElementById('estWeight'),
            makingPerGram: document.getElementById('estMakingPerGram')
        };
        const estRanges = {
            goldPrice: document.getElementById('estGoldPriceRange'),
            weight: document.getElementById('estWeightRange'),
            makingPerGram: document.getElementById('estMakingPerGramRange')
        };
        const estResults = {
            rawGold: document.getElementById('estResRawGold'),
            totalMaking: document.getElementById('estResTotalMaking'),
            vat: document.getElementById('estResVat'),
            totalPrice: document.getElementById('estResTotalPrice')
        };

        const langToggle = document.getElementById('langToggle');
        const langLabel = document.getElementById('langLabel');

        // Settings Elements
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsModal = document.getElementById('settingsModal');
        const closeSettings = document.getElementById('closeSettings');
        const saveSettings = document.getElementById('saveSettings');
        const currencySelect = document.getElementById('currencySelect');
        const karatSelect = document.getElementById('karatSelect');
        const livePriceValue = document.getElementById('livePriceValue');
        const livePriceContainer = document.getElementById('livePriceContainer');

        // Format Currency
        const formatCurrency = (num) => {
            return num.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        };

        // Calculate Breakdown
        const calculateBreakdown = () => {
            const goldPrice = parseFloat(inputs.goldPrice.value) || 0;
            const itemPrice = parseFloat(inputs.itemPrice.value) || 0;
            const weight = parseFloat(inputs.weight.value) || 0;

            if (goldPrice > 0 && itemPrice > 0 && weight > 0) {
                const vatAmount = itemPrice * 0.09;
                const priceNoVat = itemPrice - vatAmount;
                const rawGoldCost = weight * goldPrice;
                const totalMaking = priceNoVat - rawGoldCost;
                const makingPerGram = totalMaking / weight;

                results.vat.textContent = formatCurrency(vatAmount);
                results.priceNoVat.textContent = formatCurrency(priceNoVat);
                results.rawGold.textContent = formatCurrency(rawGoldCost);
                results.totalMaking.textContent = formatCurrency(totalMaking);
                results.makingPerGram.textContent = formatCurrency(makingPerGram);
            } else {
                Object.values(results).forEach(el => el.textContent = '0.00');
            }
        };

        // Calculate Estimator
        const calculateEstimator = () => {
            const goldPrice = parseFloat(estInputs.goldPrice.value) || 0;
            const weight = parseFloat(estInputs.weight.value) || 0;
            const makingPerGram = parseFloat(estInputs.makingPerGram.value) || 0;

            if (goldPrice > 0 && weight > 0) {
                const rawGoldCost = weight * goldPrice;
                const totalMaking = weight * makingPerGram;
                const priceNoVat = rawGoldCost + totalMaking;
                const vatAmount = priceNoVat * 0.09;
                const totalPrice = priceNoVat + vatAmount;

                estResults.rawGold.textContent = formatCurrency(rawGoldCost);
                estResults.totalMaking.textContent = formatCurrency(totalMaking);
                estResults.vat.textContent = formatCurrency(vatAmount);
                estResults.totalPrice.textContent = formatCurrency(totalPrice);
            } else {
                Object.values(estResults).forEach(el => el.textContent = '0.00');
            }
        };

        // Sync Inputs and Ranges
        const syncInputs = (source, target, callback) => {
            target.value = source.value;
            callback();
        };

        // Event Listeners - Breakdown
        Object.keys(inputs).forEach(key => {
            const input = inputs[key];
            const range = ranges[key];
            input.addEventListener('input', () => syncInputs(input, range, calculateBreakdown));
            range.addEventListener('input', () => syncInputs(range, input, calculateBreakdown));
        });

        // Event Listeners - Estimator
        Object.keys(estInputs).forEach(key => {
            const input = estInputs[key];
            const range = estRanges[key];
            input.addEventListener('input', () => syncInputs(input, range, calculateEstimator));
            range.addEventListener('input', () => syncInputs(range, input, calculateEstimator));
        });

        // Tab Switching
        const switchTab = (tabName) => {
            const breakdownView = document.getElementById('view-breakdown');
            const estimatorView = document.getElementById('view-estimator');
            const tabBreakdown = document.getElementById('tab-breakdown');
            const tabEstimator = document.getElementById('tab-estimator');

            if (tabName === 'breakdown') {
                breakdownView.classList.remove('hidden');
                breakdownView.classList.add('flex');
                estimatorView.classList.add('hidden');
                estimatorView.classList.remove('flex');

                tabBreakdown.classList.add('bg-gold-500', 'text-white', 'shadow-sm');
                tabBreakdown.classList.remove('text-slate-500', 'hover:text-slate-700');

                tabEstimator.classList.remove('bg-gold-500', 'text-white', 'shadow-sm');
                tabEstimator.classList.add('text-slate-500', 'hover:text-slate-700');

                calculateBreakdown();
            } else {
                breakdownView.classList.add('hidden');
                breakdownView.classList.remove('flex');
                estimatorView.classList.remove('hidden');
                estimatorView.classList.add('flex');

                tabEstimator.classList.add('bg-gold-500', 'text-white', 'shadow-sm');
                tabEstimator.classList.remove('text-slate-500', 'hover:text-slate-700');

                tabBreakdown.classList.remove('bg-gold-500', 'text-white', 'shadow-sm');
                tabBreakdown.classList.add('text-slate-500', 'hover:text-slate-700');

                calculateEstimator();
            }
        };

        // Language Switcher
        langToggle.addEventListener('click', () => {
            currentLang = currentLang === 'en' ? 'ar' : 'en';

            langLabel.textContent = currentLang === 'en' ? 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©' : 'English';
            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            document.documentElement.lang = currentLang;

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[currentLang][key]) {
                    el.textContent = translations[currentLang][key];
                }
            });
        });

        // --- Settings & Live Price Logic ---

        // Open/Close Modal
        const toggleModal = (show) => {
            if (show) {
                settingsModal.classList.remove('hidden');
                currencySelect.value = settings.currency;
                karatSelect.value = settings.karat;
            } else {
                settingsModal.classList.add('hidden');
            }
        };

        settingsBtn.addEventListener('click', () => toggleModal(true));
        closeSettings.addEventListener('click', () => toggleModal(false));
        settingsModal.addEventListener('click', (e) => {
            if (e.target === settingsModal) toggleModal(false);
        });

        // Save Settings
        saveSettings.addEventListener('click', () => {
            settings.currency = currencySelect.value;
            settings.karat = karatSelect.value;

            localStorage.setItem('goldCalc_currency', settings.currency);
            localStorage.setItem('goldCalc_karat', settings.karat);

            toggleModal(false);
            fetchGoldPrice(); // Refresh price with new settings
        });

        // Fetch Gold Price
        const fetchGoldPrice = async () => {
            livePriceValue.textContent = "Loading...";
            try {
                // Fetch XAU/USD (1 oz)
                // Using a reliable free API or fallback
                // Note: In a real app, use a robust backend proxy. Here we use a public endpoint.
                // Fallback to a static realistic value if API fails to avoid broken UI in demo.
                let priceUSD_oz = 2650.00; // Default fallback (approx current price)

                try {
                    const response = await fetch('https://api.gold-api.com/price/XAU');
                    if (response.ok) {
                        const data = await response.json();
                        priceUSD_oz = data.price;
                    }
                } catch (e) {
                    console.warn("API fetch failed, using fallback price");
                }

                // Conversions
                // 1 oz = 31.1035 grams
                const priceUSD_gram_24k = priceUSD_oz / 31.1035;

                // Convert to selected currency
                const rate = exchangeRates[settings.currency] || 1;
                const priceLocal_gram_24k = priceUSD_gram_24k * rate;

                // Convert to selected karat
                const karatFactor = parseInt(settings.karat) / 24;
                const finalPrice = priceLocal_gram_24k * karatFactor;

                // Display
                livePriceValue.textContent = `${formatCurrency(finalPrice)} ${settings.currency} (${settings.karat}K)`;
                livePriceContainer.dataset.price = finalPrice.toFixed(2);

            } catch (error) {
                livePriceValue.textContent = "Error";
                console.error(error);
            }
        };

        // Click to Fill
        livePriceContainer.addEventListener('click', () => {
            const price = livePriceContainer.dataset.price;
            if (price) {
                // Update Breakdown Input
                inputs.goldPrice.value = price;
                ranges.goldPrice.value = price; // Sync slider
                calculateBreakdown();

                // Update Estimator Input
                estInputs.goldPrice.value = price;
                estRanges.goldPrice.value = price; // Sync slider
                calculateEstimator();

                // Visual feedback
                livePriceContainer.classList.add('ring-2', 'ring-gold-400');
                setTimeout(() => livePriceContainer.classList.remove('ring-2', 'ring-gold-400'), 200);
            }
        });

        // Initial Setup
        document.addEventListener('DOMContentLoaded', () => {
            // Set initial values
            Object.keys(inputs).forEach(key => ranges[key].value = inputs[key].value || 0);
            Object.keys(estInputs).forEach(key => estRanges[key].value = estInputs[key].value || 0);

            calculateBreakdown();
            calculateEstimator();
            switchTab('breakdown');

            // Initial Fetch
            fetchGoldPrice();

            // Refresh every 60s
            setInterval(fetchGoldPrice, 60000);
        });
    </script>
</body>

</html>